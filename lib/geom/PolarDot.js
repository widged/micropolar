define(['d3', 'accessmaker'], function(d3, AccessMaker) {

    var FN = {};

    var Class = function PolarDot() {};

    Class.geom = function(angular, radial, frame, options) {

        var layout = Class.layout(angular, radial, frame, options);

        return function(geometryGroup, data) {
            data = layout(data);

            var geometry = geometryGroup.selectAll('.mark').data(data);
            geometry.enter().append('circle').attr({'class': 'mark'});
            geometry.attr({
                'class' : function(d, i) { return 'mark item-' + i; },
                cy: function(d){ return d.cy; },
                r: function(d) { return d.radius; },
                transform: function(d) { return 'rotate('+ (d.rotate) +')'; }
            });
        };
    };

    Class.layout = function(angular, radial, frame, options) {
        var originTheta = frame.originTheta || 0;
        var dotRadius   = options.dotRadius || 3;

        return function(data) {
            /*
           
[591, 33] [3, 27.535211267605636, 57.24000000000001] PolarDot.js?bust=v90:35
[658, 52] [3, 58.309859154929576, 33.119999999999976] PolarDot.js?bust=v90:35
[493, 69] [3, 85.84507042253522, 92.52000000000001] PolarDot.js?bust=v90:35
[277, 73] [3, 92.32394366197184, 170.27999999999997] PolarDot.js?bust=v90:35
[608, 70] [3, 87.46478873239437, 51.120000000000005] PolarDot.js?bust=v90:35
[340, 33] [3, 27.535211267605636, 147.6] PolarDot.js?bust=v90:35
[215, 63] [3, 76.12676056338029, 192.60000000000002] PolarDot.js?bust=v90:35
[407, 52] [3, 58.309859154929576, 123.47999999999999] PolarDot.js?bust=v90:35
[625, 39] [3, 37.25352112676057, 45] PolarDot.js?bust=v90:35
[435, 64] [3, 77.74647887323944, 113.4] PolarDot.js?bust=v90:35
[167, 54] [3, 61.549295774647895, 209.88] PolarDot.js?bust=v90:35
[300, 38] [3, 35.633802816901415, 162] PolarDot.js?bust=v90:35
[293, 55] [3, 63.16901408450705, 164.52] PolarDot.js?bust=v90:35
[319, 48] [3, 51.83098591549296, 155.16] PolarDot.js?bust=v90:35
[434, 41] [3, 40.49295774647888, 113.75999999999999] PolarDot.js?bust=v90:35
[517, 62] [3, 74.50704225352113, 83.88] PolarDot.js?bust=v90:35
[559, 61] [3, 72.88732394366198, 68.75999999999999] PolarDot.js?bust=v90:35
[425, 53] [3, 59.92957746478873, 117] PolarDot.js?bust=v90:35
[562, 54] [3, 61.549295774647895, 67.67999999999998] PolarDot.js?bust=v90:35
[671, 75] [3, 95.56338028169014, 28.439999999999998] PolarDot.js?bust=v90:35
[521, 46] [3, 48.59154929577465, 82.44] PolarDot.js?bust=v90:35
[795, 16] [3, 0, -16.19999999999999] PolarDot.js?bust=v90:35
[495, 49] [3, 53.45070422535211, 91.80000000000001] PolarDot.js?bust=v90:35
[298, 74] [3, 93.94366197183099, 162.72] PolarDot.js?bust=v90:35
[417, 34] [3, 29.154929577464788, 119.88] PolarDot.js?bust=v90:35
[704, 57] [3, 66.40845070422536, 16.560000000000002] PolarDot.js?bust=v90:35
[385, 50] [3, 55.07042253521127, 131.4] PolarDot.js?bust=v90:35
[577, 88] [3, 116.61971830985915, 62.28000000000003] PolarDot.js?bust=v90:35
[578, 37] [3, 34.014084507042256, 61.920000000000016] PolarDot.js?bust=v90:35
[541, 38] [3, 35.633802816901415, 75.23999999999998] PolarDot.js?bust=v90:35
[588, 37] [3, 34.014084507042256, 58.32000000000002] PolarDot.js?bust=v90:35
[411, 15] [3, -1.619718309859155, 122.03999999999999] PolarDot.js?bust=v90:35
[262, 42] [3, 42.11267605633803, 175.68] PolarDot.js?bust=v90:35
[581, 31] [3, 24.295774647887324, 60.84] PolarDot.js?bust=v90:35
[202, 48] [3, 51.83098591549296, 197.27999999999997] PolarDot.js?bust=v90:35
[223, 27] [3, 17.816901408450708, 189.72000000000003] PolarDot.js?bust=v90:35
[604, 47] [3, 50.21126760563381, 52.56] PolarDot.js?bust=v90:35
[416, 65] [3, 79.36619718309859, 120.23999999999998] PolarDot.js?bust=v90:35
[457, 48] [3, 51.83098591549296, 105.47999999999999] PolarDot.js?bust=v90:35
[711, 67] [3, 82.60563380281691, 14.04000000000002] PolarDot.js?bust=v90:35
[237, 48] [3, 51.83098591549296, 184.68] PolarDot.js?bust=v90:35
[325, 47] [3, 50.21126760563381, 153] PolarDot.js?bust=v90:35
[374, 47] [3, 50.21126760563381, 135.36] PolarDot.js?bust=v90:35
[574, 49] [3, 53.45070422535211, 63.359999999999985] PolarDot.js?bust=v90:35
[187, 78] [3, 100.42253521126761, 202.68] PolarDot.js?bust=v90:35
[493, 50] [3, 55.07042253521127, 92.52000000000001] PolarDot.js?bust=v90:35
[744, 70] [3, 87.46478873239437, 2.160000000000025] PolarDot.js?bust=v90:35
[609, 59] [3, 69.64788732394366, 50.75999999999999] PolarDot.js?bust=v90:35
[746, 17] [3, 1.619718309859155, 1.4399999999999977] PolarDot.js?bust=v90:35
[591, 72] [3, 90.70422535211269, 57.24000000000001] PolarDot.js?bust=v90:35
[882, 43] [3, 43.732394366197184, -47.51999999999998] PolarDot.js?bust=v90:35
[433, 46] [3, 48.59154929577465, 114.12] PolarDot.js?bust=v90:35
[694, 23] [3, 11.338028169014086, 20.159999999999968] PolarDot.js?bust=v90:35
[583, 22] [3, 9.71830985915493, 60.120000000000005] PolarDot.js?bust=v90:35
[672, 43] [3, 43.732394366197184, 28.079999999999984] PolarDot.js?bust=v90:35
[418, 25] [3, 14.577464788732394, 119.52000000000001] PolarDot.js?bust=v90:35
[431, 55] [3, 63.16901408450705, 114.84] PolarDot.js?bust=v90:35
[303, 49] [3, 53.45070422535211, 160.92000000000002] PolarDot.js?bust=v90:35
[840, 20] [3, 6.47887323943662, -32.39999999999998] PolarDot.js?bust=v90:35
[589, 56] [3, 64.7887323943662, 57.96000000000001] PolarDot.js?bust=v90:35
[542, 76] [3, 97.1830985915493, 74.88] PolarDot.js?bust=v90:35
[559, 50] [3, 55.07042253521127, 68.75999999999999] PolarDot.js?bust=v90:35
[532, 49] [3, 53.45070422535211, 78.47999999999999] PolarDot.js?bust=v90:35
[231, 27] [3, 17.816901408450708, 186.83999999999997] PolarDot.js?bust=v90:35
[363, 43] [3, 43.732394366197184, 139.32] PolarDot.js?bust=v90:35
[770, 54] [3, 61.549295774647895, -7.199999999999989] PolarDot.js?bust=v90:35
[507, 38] [3, 35.633802816901415, 87.47999999999999] PolarDot.js?bust=v90:35
[667, 62] [3, 74.50704225352113, 29.879999999999995] PolarDot.js?bust=v90:35
[441, 36] [3, 32.3943661971831, 111.24000000000001] PolarDot.js?bust=v90:35
[377, 60] [3, 71.26760563380283, 134.28] PolarDot.js?bust=v90:35
[426, 36] [3, 32.3943661971831, 116.64000000000001] PolarDot.js?bust=v90:35
[672, 54] [3, 61.549295774647895, 28.079999999999984] PolarDot.js?bust=v90:35
[566, 38] [3, 35.633802816901415, 66.23999999999998] PolarDot.js?bust=v90:35
[330, 24] [3, 12.95774647887324, 151.2] PolarDot.js?bust=v90:35
[470, 64] [3, 77.74647887323944, 100.79999999999998] PolarDot.js?bust=v90:35
[746, 48] [3, 51.83098591549296, 1.4399999999999977] PolarDot.js?bust=v90:35
[546, 51] [3, 56.690140845070424, 73.44] PolarDot.js?bust=v90:35
[235, 39] [3, 37.25352112676057, 185.39999999999998] PolarDot.js?bust=v90:35
[445, 31] [3, 24.295774647887324, 109.80000000000001] PolarDot.js?bust=v90:35
[275, 58] [3, 68.02816901408451, 171] PolarDot.js?bust=v90:35
[476, 50] [3, 55.07042253521127, 98.63999999999999] PolarDot.js?bust=v90:35
[412, 36] [3, 32.3943661971831, 121.67999999999998] PolarDot.js?bust=v90:35
[275, 50] [3, 55.07042253521127, 171] PolarDot.js?bust=v90:35
[523, 69] [3, 85.84507042253522, 81.72] PolarDot.js?bust=v90:35
[484, 44] [3, 45.35211267605634, 95.75999999999999] PolarDot.js?bust=v90:35
[700, 42] [3, 42.11267605633803, 17.99999999999997] PolarDot.js?bust=v90:35
[461, 55] [3, 63.16901408450705, 104.03999999999999] PolarDot.js?bust=v90:35
[537, 25] [3, 14.577464788732394, 76.67999999999998] PolarDot.js?bust=v90:35
[555, 69] [3, 85.84507042253522, 70.19999999999999] PolarDot.js?bust=v90:35
[431, 53] [3, 59.92957746478873, 114.84] PolarDot.js?bust=v90:35
[454, 51] [3, 56.690140845070424, 106.56] PolarDot.js?bust=v90:35
[514, 45] [3, 46.971830985915496, 84.96000000000001] PolarDot.js?bust=v90:35
[278, 34] [3, 29.154929577464788, 169.91999999999996] PolarDot.js?bust=v90:35
[541, 64] [3, 77.74647887323944, 75.23999999999998] PolarDot.js?bust=v90:35
[473, 49] [3, 53.45070422535211, 99.72] PolarDot.js?bust=v90:35
[779, 40] [3, 38.87323943661972, -10.439999999999998] PolarDot.js?bust=v90:35
[648, 47] [3, 50.21126760563381, 36.72] PolarDot.js?bust=v90:35
[640, 27] [3, 17.816901408450708, 39.599999999999994] PolarDot.js?bust=v90:35
[611, 38] [3, 35.633802816901415, 50.03999999999999] PolarDot.js?bust=v90:35
[690, 76] [3, 97.1830985915493, 21.599999999999966] 

            */
            return data.map(function(d, i) {
                var rotate = (originTheta - 90 + (angular(d[0])));
                var radius = dotRadius;
                var cy = radial(d[1]);
                return {rotate: rotate, radius: radius, cy: cy};
            });
        };
    };

    return Class;

});
